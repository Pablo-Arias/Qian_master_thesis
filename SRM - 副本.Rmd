---
title: "SRM"
author: "Qian"
date: "2025-03-18"
output: html_document
---

# Load the tidyverse package below
```{r T101, warning=FALSE, message=FALSE}
# Load the tidyverse package below
cat("\f")
rm(list=ls())

# Init
graphics.off()

#install.packages("ez")
#("phia")
#install.packages("effsize")
#install.packages("srm")
#install.packages("TripleR")
library("MASS")
library(ez)
library(afex)
library(phia)
library(doBy)
library(effsize)
library(lmerTest);
library(dplyr);
library(srm);
library(ggplot2)
library(TripleR)
library(tidyverse)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))


#Import data
file_name = "data/behavior/all_data_df.csv"

#read data
data = read.table(file_name, header=TRUE,sep=',')
head(data)

#defining outcomes
measure			          <-as.numeric(data$measure)

#defining predictors (categorical)
participant_condition 	<- as.factor(data$participant_condition)
participant_condition   <- relevel(participant_condition, "S")
other_condition 		    <- as.factor(data$other_condition)
other_condition         <- relevel(other_condition, "S")
participant_nb			    <- as.factor(data$user_id)
interacting_partner			<- as.factor(data$other_id)
question_content		    <- as.factor(data$question_content)
group_id		            <- as.factor(data$sid)

#create new dataframe
all_data=data.frame( measure, participant_condition , interacting_partner, other_condition, participant_nb, question_content, group_id )

## -------------------------------------- ##
## -------------------------------------- ##
## GLMM Analysis ------------------------ ##
## -------------------------------------- ##
## -------------------------------------- ##

# Choose the question you want to anlayse
#question = "conversation_quality"
#question = "liked"
#question = "other_liked"
question = "video_conf_quality"

clean_data <- all_data[all_data$question_content == question,]
head(clean_data)


#Social relation Model
RR.style("perception")

#Round Robin
RR1 <- RR(measure ~ participant_nb * interacting_partner | group_id, data = clean_data, na.rm = TRUE)
RR1


#Missing values
plot_missings(measure ~ participant_nb * interacting_partner | group_id, data = clean_data, show.ids = FALSE)

#Variance covariance
plot(RR1)


RR1$effects #measure perceiver and target
RR1$effectsRel

result_file = paste("data/behavior/srm/",question,".csv", sep="")
write.csv(RR1$effectsRel, result_file) #Relationships

# ä¿å­˜ perceiver & target effects
result_file_effects <- paste("data/behavior/srm/", question, "_effects.csv", sep = "")
write.csv(RR1$effects, result_file_effects, row.names = FALSE)

df = data(likingLong)


str(likingLong)

# Load required libraries
library(lme4)
library(ggplot2)

# Function to run GLMM for each SRM dataset
run_srm_glmm <- function(data, title) {
  # Ensure factors are properly set
  data$participant_condition <- as.factor(data$participant_condition)
  data$other_condition <- as.factor(data$other_condition)

  # Run the GLMM
  glmm_model <- lmer(relationship ~ participant_condition * other_condition + 
                      (1 | participant_nb) + (1 | interacting_partner), 
                      data = data)
  
  # Print summary
  print(summary(glmm_model))
  
  # Plot results
  ggplot(data, aes(x = participant_condition, y = relationship, color = other_condition)) +
    geom_point(alpha = 0.3, position = position_jitter(width = 0.2)) +
    stat_summary(fun = mean, geom = "point", size = 4, position = position_dodge(0.2)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2, position = position_dodge(0.2)) +
    labs(title = title, x = "Participant Condition", y = "Relationship Rating (SRM)") +
    scale_color_manual(values = c("red", "blue")) +
    theme_minimal()
}


# Load datasets
liked <- read_csv("data/behavior/srm/liked.csv")
other_liked <- read_csv("data/behavior/srm/other_liked.csv")
conversation_quality <- read_csv("data/behavior/srm/conversation_quality.csv")
video_conf_quality <- read_csv("data/behavior/srm/video_conf_quality.csv")


# Run SRM GLMM for each dataset
run_srm_glmm(liked, "Liked (SRM Relationship)")
run_srm_glmm(other_liked, "Other Liked Me (SRM Relationship)")
run_srm_glmm(conversation_quality, "Conversation Quality (SRM Relationship)")
run_srm_glmm(video_conf_quality, "Video Conference Quality (SRM Relationship)")

```
```{r}
#åˆå¹¶æ•°æ®
# ç­›é€‰ä¸»è¡¨ä¸­ question_content ä¸º liked çš„å­é›†

               # â† liked ä¸­å« relationship å€¼

library(dplyr)
library(readr)

# 1. è¯»å–æ•°æ®
all_data_df <- read.csv("data/behavior/all_data_df.csv")     # â† æ›¿æ¢ä¸ºä½ çš„è·¯å¾„
liked <- read_csv("data/behavior/srm/liked.csv")                  # â† liked ä¸­å« relationship å€¼



# 2. é‡å‘½å liked å­è¡¨å­—æ®µä»¥åŒ¹é…ä¸»è¡¨
liked_clean <- liked %>%
  rename(
    sid = group.id,
    user_id = participant_nb,
    other_id = interacting_partner
  ) %>%
  mutate(
    sid = as.character(sid),
    user_id = as.character(user_id),
    other_id = as.character(other_id)
  )

# 3. ç¡®ä¿ä¸»è¡¨å­—æ®µç±»å‹ä¸€è‡´
all_data_df <- all_data_df %>%
  mutate(
    sid = as.character(sid),
    user_id = as.character(user_id),
    other_id = as.character(other_id)
  )

# 4. ä»…å¯¹ liked æ¡ç›®åˆå¹¶ relationship åˆ†æ•°
all_data_liked <- all_data_df %>%
  filter(question_content == "liked") %>%
  left_join(
    liked_clean[, c("sid", "user_id", "other_id", "relationship")],
    by = c("sid", "user_id", "other_id")
  )

# 5. é liked æ¡ç›®ä¿æŒåŸæ ·ï¼Œrelationship è®¾ä¸º NA
all_data_other <- all_data_df %>%
  filter(question_content != "liked") %>%
  mutate(relationship = NA)

# 6. åˆå¹¶ä¸ºå®Œæ•´è¡¨
all_data_srm <- bind_rows(all_data_other, all_data_liked)

# 7. ä¿å­˜ç»“æœä¸ºæ–°æ–‡ä»¶
write_csv(all_data_srm, "all_data_srm.csv")


```
```{r}
#åˆå¹¶relationship
#å¾ªç¯éå†è¯»å–æ‰€æœ‰é—®é¢˜çš„
library(dplyr)
library(readr)

# 1. è¯»å–ä¸»è¡¨
all_data_df <- read_csv("data/behavior/all_data_df.csv") %>%
  mutate(
    sid = as.character(sid),
    user_id = as.character(user_id),
    other_id = as.character(other_id)
  )

# 2. è®¾å®šå­è¡¨æ–‡ä»¶æ‰€åœ¨è·¯å¾„
srm_path <- "data/behavior/srm"
question_list <- c("liked", "other_liked", "conversation_quality", "video_conf_quality")

# 3. ç”¨äºå­˜å‚¨æ¯ä¸€ç±»åˆå¹¶åçš„æ•°æ®
merged_chunks <- list()

# 4. å¾ªç¯è¯»å–å¹¶åˆå¹¶
for (question in question_list) {
  
  file_path <- file.path(srm_path, paste0(question, ".csv"))
  
  if (file.exists(file_path)) {
    
    srm_df <- read_csv(file_path) %>%
      rename(
        sid = group.id,
        user_id = participant_nb,
        other_id = interacting_partner
      ) %>%
      mutate(
        sid = as.character(sid),
        user_id = as.character(user_id),
        other_id = as.character(other_id)
      )
    
    # ç­›é€‰ä¸»è¡¨ä¸­å¯¹åº” question çš„å­é›†å¹¶åˆå¹¶
    data_q <- all_data_df %>%
      filter(question_content == question) %>%
      left_join(
        srm_df[, c("sid", "user_id", "other_id", "relationship")],
        by = c("sid", "user_id", "other_id")
      )
    
    merged_chunks[[question]] <- data_q
    
  } else {
    message(paste("âš ï¸ æ–‡ä»¶æœªæ‰¾åˆ°:", file_path, "- å·²è·³è¿‡è¯¥é¡¹"))
    
    # æ— æ–‡ä»¶ä¹Ÿä¿ç•™æ•°æ®å¹¶å¡«å…¥ NA
    merged_chunks[[question]] <- all_data_df %>%
      filter(question_content == question) %>%
      mutate(relationship = NA)
  }
}

# 5. åˆå¹¶æ‰€æœ‰éƒ¨åˆ†
all_data_srm <- bind_rows(merged_chunks)

# 6. ä¿å­˜æœ€ç»ˆæ•°æ®
write_csv(all_data_srm, "all_data_srm.csv")

message("âœ… all_data_srm.csv å·²æˆåŠŸä¿å­˜ï¼")

```
```{r}
#å®šä¹‰function
# Load required libraries
library(lme4)
library(ggplot2)

# Function to run GLMM for each SRM dataset
run_srm_glmm <- function(data, title) {
  # Ensure factors are properly set
  data$participant_condition <- as.factor(data$participant_condition)
  data$other_condition <- as.factor(data$other_condition)

  # Run the GLMM
  glmm_model <- lmer(relationship ~ participant_condition * other_condition + 
                      (1 | participant_nb) + (1 | interacting_partner), 
                      data = data)
  
  # Print summary
  print(summary(glmm_model))
  
  # Plot results
  ggplot(data, aes(x = participant_condition, y = relationship, color = other_condition)) +
    geom_point(alpha = 0.3, position = position_jitter(width = 0.2)) +
    stat_summary(fun = mean, geom = "point", size = 4, position = position_dodge(0.2)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2, position = position_dodge(0.2)) +
    labs(title = title, x = "Participant Condition", y = "Relationship Rating (SRM)") +
    scale_color_manual(values = c("red", "blue")) +
    theme_minimal()
}


# Load datasets
liked <- read_csv("data/behavior/srm/liked.csv")
other_liked <- read_csv("data/behavior/srm/other_liked.csv")
conversation_quality <- read_csv("data/behavior/srm/conversation_quality.csv")
video_conf_quality <- read_csv("data/behavior/srm/video_conf_quality.csv")


# Run SRM GLMM for each dataset
run_srm_glmm(liked, "Liked (SRM Relationship)")
run_srm_glmm(other_liked, "Other Liked Me (SRM Relationship)")
run_srm_glmm(conversation_quality, "Conversation Quality (SRM Relationship)")
run_srm_glmm(video_conf_quality, "Video Conference Quality (SRM Relationship)")
```



```{r}
#ç”¨è€å¸ˆçš„æ–¹æ³•
#é‡ç°å›¾è¡¨ ç”¨srmæ¨¡å‹

library(lme4)
library(ggplot2)

# Function to run GLMM for each SRM dataset
run_srm_glmm <- function(data, title) {
  # Ensure factors are properly set
  data$participant_condition <- as.factor(data$participant_condition)
  data$other_condition <- as.factor(data$other_condition)

  # Run the GLMM
  glmm_model <- lmer(relationship ~ participant_condition * other_condition + 
                      (1 | participant_nb) + (1 | interacting_partner), 
                      data = data)
  
  # Print summary
  print(summary(glmm_model))
  
  # Plot results
  ggplot(data, aes(x = participant_condition, y = relationship, color = other_condition)) +
    geom_point(alpha = 0.3, position = position_jitter(width = 0.2)) +
    stat_summary(fun = mean, geom = "point", size = 4, position = position_dodge(0.2)) +
    stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2, position = position_dodge(0.2)) +
    labs(title = title, x = "Participant Condition", y = "Relationship Rating (SRM)") +
    scale_color_manual(values = c("red", "blue")) +
    theme_minimal()
}



liked <- read_csv("all_data_srm.csv") %>%


# Run SRM GLMM for each dataset
run_srm_glmm(liked, "Liked (SRM Relationship)")

```

```{r}
#2ç”¨è‡ªå·±çš„æ–¹æ³•  relationship
#é‡ç°å›¾è¡¨ ç”¨srmæ¨¡å‹

# 1. åŠ è½½åŒ…
library(tidyverse)
library(dplyr)
library(TripleR)
library(lme4)
library(lmerTest)
library(ggplot2)

# 2. å‡è®¾æ•°æ®å·²è¯»å…¥ä¸º df
df <- read_csv("all_data_srm.csv")





# ä¿®æ­£ç¼–ç ï¼ˆS = decrease smile, U = increase smileï¼‰
df <- df %>%
  mutate(
    participant_condition = recode(participant_condition, "S" = "decrease", "U" = "increase"),
    other_condition = recode(other_condition, "S" = "decrease", "U" = "increase")
  )

# æ˜ å°„æ ‡ç­¾
df$question_label <- recode(df$question_content,
  "liked" = "A. Liked",
  "other_liked" = "B. Other liked me",
  "conversation_quality" = "C. Conversation quality",
  "video_conf_quality" = "D. Video conference quality"
)

# è®¾ç½®å› å­é¡ºåºï¼ˆä¿è¯å›¾è¡¨æ’åºå’Œé…è‰²ä¸€è‡´ï¼‰
df$participant_condition <- factor(df$participant_condition, levels = c("increase", "decrease"))
df$other_condition <- factor(df$other_condition, levels = c("increase", "decrease"))
df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# ç»˜å›¾
g <- ggplot(df, aes(x = participant_condition, y = relationship, color = other_condition)) +
  geom_jitter(width = 0.15, alpha = 0.2, size = 1.2) +  # æ•£ç‚¹å›¾å±‚
  stat_summary(fun = mean, geom = "point", size = 3,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun = mean, geom = "line",
               position = position_dodge(width = 0.4), aes(group = other_condition), size = 0.8) +
  scale_color_manual(values = c("increase" = "red", "decrease" = "blue"),
                     name = "Other condition",
                     labels = c("increase smile", "decrease smile")) +
  facet_wrap(~question_label, nrow = 1) +
  labs(
    x = "Participant condition",
    y = "Participant Rating\n(relationship value in the SRM)",
    title = "Figure 6. Psychological analysis"
  ) +
  theme_minimal(base_size = 12)

# å±•ç¤ºå›¾
print(g)

# å¯é€‰ï¼šä¿å­˜ä¸ºé«˜åˆ†è¾¨å›¾åƒ
ggsave("Figure6_final.png", g, width = 13, height = 5, dpi = 300)
```



```{r}
#relationship SRM 
cat("\f")
rm(list=ls())

# Init
graphics.off()

#install.packages("ez")
#("phia")
#install.packages("effsize")
#install.packages("srm")
#install.packages("TripleR")
library("MASS")
library(ez)
library(afex)
library(phia)
library(doBy)
library(effsize)
library(lmerTest);
library(dplyr);
library(srm);
library(ggplot2)
library(TripleR)
library(tidyverse)

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))


#Import data
file_name = "all_data_srm.csv"

#read data
data = read.table(file_name, header=TRUE,sep=',')
head(data)

#defining outcomes
measure			          <-as.numeric(data$measure)

#defining predictors (categorical)
participant_condition 	<- as.factor(data$participant_condition)
participant_condition   <- relevel(participant_condition, "S")
other_condition 		    <- as.factor(data$other_condition)
other_condition         <- relevel(other_condition, "S")
participant_nb			    <- as.factor(data$user_id)
interacting_partner			<- as.factor(data$other_id)
question_content		    <- as.factor(data$question_content)
group_id		            <- as.factor(data$sid)

#create new dataframe
all_data=data.frame( measure, participant_condition , interacting_partner, other_condition, participant_nb, question_content, group_id )

## -------------------------------------- ##
## -------------------------------------- ##
## GLMM Analysis ------------------------ ##
## -------------------------------------- ##
## -------------------------------------- ##

# Choose the question you want to anlayse
#question = "conversation_quality"
#question = "liked"
#question = "other_liked"
question = "video_conf_quality"

clean_data <- all_data[all_data$question_content == question,]
head(clean_data)


#Social relation Model
RR.style("perception")

#Round Robin
RR1 <- RR(measure ~ participant_nb * interacting_partner | group_id, data = clean_data, na.rm = TRUE)
RR1


#Missing values
plot_missings(measure ~ participant_nb * interacting_partner | group_id, data = clean_data, show.ids = FALSE)

#Variance covariance
plot(RR1)


RR1$effects #measure perceiver and target
RR1$effectsRel

result_file = paste("data/behavior/srm/",question,".csv", sep="")
#write.csv(RR1$effectsRel, result_file) #Relationships

# ä¿å­˜ perceiver & target effects
result_file_effects <- paste("data/behavior/srm/", question, "_effects.csv", sep = "")
#write.csv(RR1$effects, result_file_effects, row.names = FALSE)

df = data(likingLong)


str(likingLong)
```



```{r}
#æ•°æ®å¤„ç† åˆå¹¶Perceiverå’ŒTarget
library(dplyr)
library(readr)

# 1. è¯»å–ä¸»è¡¨å’Œå­è¡¨
all_data_srm <- read_csv("all_data_srm.csv")
liked_effects <- read_csv("data/behavior/srm/liked_effects.csv")


# 2. é‡å‘½å liked_effects åˆ—ä»¥ä¾¿åŒ¹é…
liked_clean <- liked_effects %>%
  rename(
    sid = group.id,
    perceiver_effect = measure.p,
    target_effect = measure.t
  ) %>%
  mutate(
    sid = as.character(sid)
  )

# 3. ä¸»è¡¨ç»Ÿä¸€ç±»å‹
all_data_srm <- all_data_srm %>%
  mutate(
    sid = as.character(sid),
    user_id = as.character(user_id),
    other_id = as.character(other_id)
  )

# 4. åˆ†ç¦» liked å’Œå…¶ä»–éƒ¨åˆ†
liked_part <- all_data_srm %>%
  filter(question_content == "liked")

other_part <- all_data_srm %>%
  filter(question_content != "liked")

# 5. åˆå¹¶ liked éƒ¨åˆ†çš„ perceiver_effectï¼ˆæŒ‰ user_id åŒ¹é… perceiverï¼‰
liked_part <- liked_part %>%
  left_join(liked_clean[, c("sid", "perceiver_effect")],
            by = c("sid"))

# 6. åˆå¹¶ liked éƒ¨åˆ†çš„ target_effectï¼ˆæŒ‰ other_id åŒ¹é… targetï¼‰
liked_part <- liked_part %>%
  left_join(liked_clean[, c("sid", "target_effect")],
            by = c("sid"))

# 7. åˆå¹¶å®Œæ•´æ•°æ®
all_data_srm_all <- bind_rows(other_part, liked_part)

# 8. ä¿å­˜ä¸ºæ–°æ–‡ä»¶
write_csv(all_data_srm_all, "all_data_srm_all.csv")
message("âœ… å·²ä¿å­˜ all_data_srm_all.csvï¼ŒåŒ…å« liked çš„ä¸ªä½“æ•ˆåº”ï¼")



```

```{r}
#éå†å¤„ç†æ•°æ®
library(dplyr)
library(readr)



# 1. è¯»å–ä¸»è¡¨
all_data_df <- read_csv("all_data_srm.csv") %>%
  mutate(
    sid = as.character(sid),
    user_id=as.character(user_id)  )

# 2. è®¾å®šå­è¡¨æ–‡ä»¶æ‰€åœ¨è·¯å¾„
srm_path <- "data/behavior/srm"
question_list <- c("liked", "other_liked", "conversation_quality", "video_conf_quality")

# 3. ç”¨äºå­˜å‚¨æ¯ä¸€ç±»åˆå¹¶åçš„æ•°æ®
merged_chunks <- list()

# 4. å¾ªç¯è¯»å–å¹¶åˆå¹¶
for (question in question_list) {
  
  file_path <- file.path(srm_path, paste0(question, "_effects.csv"))
  
  if (file.exists(file_path)) {
    
    srm_df <- read_csv(file_path) %>%
      rename(
        sid = group.id,
        user_id = id
      ) %>%
      mutate(
        sid = as.character(sid),
        user_id = as.character(user_id)
      )
    
    # ç­›é€‰ä¸»è¡¨ä¸­å¯¹åº” question çš„å­é›†å¹¶åˆå¹¶
    data_q <- all_data_df %>%
      filter(question_content == question) %>%
      left_join(
        srm_df[, c("sid", "user_id", "measure.p", "measure.t")],
        by = c("sid", "user_id")
      )
    
    merged_chunks[[question]] <- data_q
    
  } else {
    message(paste("âš ï¸ æ–‡ä»¶æœªæ‰¾åˆ°:", file_path, "- å·²è·³è¿‡è¯¥é¡¹"))
    
    # æ— æ–‡ä»¶ä¹Ÿä¿ç•™æ•°æ®å¹¶å¡«å…¥ NA
    merged_chunks[[question]] <- all_data_df %>%
      filter(question_content == question) %>%
      mutate(relationship = NA)
  }
}

# 5. åˆå¹¶æ‰€æœ‰éƒ¨åˆ†
all_data_srm <- bind_rows(merged_chunks)

# 6. ä¿å­˜æœ€ç»ˆæ•°æ®
write_csv(all_data_srm, "all_data_srm_all.csv")
message("ğŸ‰ æ‰€æœ‰å¯ç”¨æ•ˆåº”å·²æˆåŠŸåˆå¹¶åˆ° all_data_srm_all.csv")




```

```{r}
#å»é‡
library(dplyr)
library(readr)

# è¯»å–æ•°æ®
df <- read_csv("all_data_srm_all.csv")

# æŒ‰ sid å’Œ user_id åˆ†ç»„ï¼Œä¿ç•™ç¬¬ä¸€æ¡è®°å½•ï¼ˆå›  perceiver/target_effect ç›¸åŒï¼‰
df_unique <- df %>%
  group_by(sid, user_id , question_content) %>%
  slice(1) %>%
  ungroup()

# ä¿å­˜å»é‡ç»“æœï¼ˆå¯é€‰ï¼‰
write_csv(df_unique, "all_data_srm_unique.csv")

message("âœ… å·²å®ŒæˆæŒ‰ sid + user_id å»é‡å¹¶ä¿ç•™å”¯ä¸€è¡Œã€‚")

```
```{r}
 #perceiver SRM
# 1. åŠ è½½åŒ…
library(tidyverse)
library(dplyr)
library(TripleR)
library(lme4)
library(lmerTest)
library(ggplot2)

# 2. å‡è®¾æ•°æ®å·²è¯»å…¥ä¸º df
df <- read_csv("all_data_srm_unique.csv")



# ä¿®æ­£ç¼–ç ï¼ˆS = decrease smile, U = increase smileï¼‰
df <- df %>%
  mutate(
    participant_condition = recode(participant_condition, "S" = "decrease", "U" = "increase"),
    other_condition = recode(other_condition, "S" = "decrease", "U" = "increase")
  )

# æ˜ å°„æ ‡ç­¾
df$question_label <- recode(df$question_content,
  "liked" = "A. Liked",
  "other_liked" = "B. Other liked me",
  "conversation_quality" = "C. Conversation quality",
  "video_conf_quality" = "D. Video conference quality"
)

# è®¾ç½®å› å­é¡ºåºï¼ˆä¿è¯å›¾è¡¨æ’åºå’Œé…è‰²ä¸€è‡´ï¼‰
df$participant_condition <- factor(df$participant_condition, levels = c("increase", "decrease"))
df$other_condition <- factor(df$other_condition, levels = c("increase", "decrease"))
df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# ç»˜å›¾
g <- ggplot(df, aes(x = participant_condition, y = measure.p, color = other_condition)) +
  geom_jitter(width = 0.15, alpha = 0.2, size = 1.2) +  # æ•£ç‚¹å›¾å±‚
  stat_summary(fun = mean, geom = "point", size = 3,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun = mean, geom = "line",
               position = position_dodge(width = 0.4), aes(group = other_condition), size = 0.8) +
  scale_color_manual(values = c("increase" = "red", "decrease" = "blue"),
                     name = "Other condition",
                     labels = c("increase smile", "decrease smile")) +
  facet_wrap(~question_label, nrow = 1) +
  labs(
    x = "Participant condition",
    y = "Participant Rating\n(relationship value in the SRM)",
    title = "Figure 6. Psychological analysis"
  ) +
  theme_minimal(base_size = 12)

# å±•ç¤ºå›¾
print(g)
```


```{r}
#perceiver SRM

library(tidyverse)

# 1. è¯»å–æ•°æ®
df <- read_csv("all_data_srm_unique.csv")

# 2. æ˜ å°„é¢˜ç›®æ ‡ç­¾ï¼ˆå¯é€‰ç¾åŒ–ï¼‰
df <- df %>%
  mutate(
    question_label = recode(question_content,
      "liked" = "A. Liked",
      "other_liked" = "B. Other liked me",
      "conversation_quality" = "C. Conversation quality",
      "video_conf_quality" = "D. Video conference quality"
    )
  )

# 3. è®¾ç½®å› å­é¡ºåºï¼ˆä¿æŒç»˜å›¾é¡ºåºä¸€è‡´ï¼‰
df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# 4. ç»˜å›¾
g <- ggplot(df, aes(x = question_label, y = measure.p)) +
  geom_jitter(width = 0.2, alpha = 0.2, color = "gray40", size = 1) +
  stat_summary(fun = mean, geom = "point", size = 3, color = "black") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.15, color = "black") +
  labs(
    x = "Question",
    y = "Perceiver Effect (measure.p)",
    title = "Perceiver Effect Across Questions (SRM)"
  ) +
  theme_minimal(base_size = 12)

# 5. å±•ç¤ºå›¾
print(g)


```

```{r}
#target SRM
library(tidyverse)

# 1. è¯»å–æ•°æ®
df <- read_csv("all_data_srm_unique.csv")

# 2. æ˜ å°„é¢˜ç›®æ ‡ç­¾ï¼ˆå¯é€‰ç¾åŒ–ï¼‰
df <- df %>%
  mutate(
    question_label = recode(question_content,
      "liked" = "A. Liked",
      "other_liked" = "B. Other liked me",
      "conversation_quality" = "C. Conversation quality",
      "video_conf_quality" = "D. Video conference quality"
    )
  )

# 3. è®¾ç½®å› å­é¡ºåºï¼ˆä¿æŒç»˜å›¾é¡ºåºä¸€è‡´ï¼‰
df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# 4. ç»˜å›¾
g <- ggplot(df, aes(x = question_label, y = measure.t)) +
  geom_jitter(width = 0.2, alpha = 0.2, color = "gray40", size = 1) +
  stat_summary(fun = mean, geom = "point", size = 3, color = "black") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.15, color = "black") +
  labs(
    x = "Question",
    y = "Target Effect (measure.t)",
    title = "Target Effect Across Questions (SRM)"
  ) +
  theme_minimal(base_size = 12)

# 5. å±•ç¤ºå›¾
print(g)

```

```{r}
#æµ‹è¯•
#target SRM
library(tidyverse)

# 1. è¯»å–æ•°æ®
df <- read_csv("all_data_srm_all.csv")

# 2. æ˜ å°„é¢˜ç›®æ ‡ç­¾ï¼ˆå¯é€‰ç¾åŒ–ï¼‰
df <- df %>%
  mutate(
    question_label = recode(question_content,
      "liked" = "A. Liked",
      "other_liked" = "B. Other liked me",
      "conversation_quality" = "C. Conversation quality",
      "video_conf_quality" = "D. Video conference quality"
    )
  )

# 3. è®¾ç½®å› å­é¡ºåºï¼ˆä¿æŒç»˜å›¾é¡ºåºä¸€è‡´ï¼‰
df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# 4. ç»˜å›¾
g <- ggplot(df, aes(x = question_label, y = relationship)) +
  geom_jitter(width = 0.2, alpha = 0.2, color = "gray40", size = 1) +
  stat_summary(fun = mean, geom = "point", size = 3, color = "black") +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.15, color = "black") +
  labs(
    x = "Question",
    y = "Target Effect (measure.t)",
    title = "Target Effect Across Questions (SRM)"
  ) +
  theme_minimal(base_size = 12)

# 5. å±•ç¤ºå›¾
print(g)
```
```{r}
#æµ‹è¯•
library(tidyverse)

# å‡è®¾ä½ å·²ç»è¯»å–å¹¶æ¸…ç†å¥½äº†æ•°æ®ä¸º df
df <- read_csv("all_data_srm_unique.csv") %>%
  mutate(
    question_label = recode(question_content,
      "liked" = "A. Liked",
      "other_liked" = "B. Other liked me",
      "conversation_quality" = "C. Conversation quality",
      "video_conf_quality" = "D. Video conference quality"
    )
  )

df$question_label <- factor(df$question_label,
  levels = c("A. Liked", "B. Other liked me", "C. Conversation quality", "D. Video conference quality"))

# ç»˜å›¾ï¼šæ¯ä¸ªå°å›¾è¡¨ç¤ºä¸€ä¸ªé—®é¢˜ç±»å‹ï¼Œå±•ç¤º measure.p
g <- ggplot(df, aes(x = participant_condition, y = measure.p, color = other_condition)) +
  geom_jitter(width = 0.15, alpha = 0.2, size = 1.2) +
  stat_summary(fun = mean, geom = "point", size = 3,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", width = 0.2,
               position = position_dodge(width = 0.4)) +
  stat_summary(fun = mean, geom = "line", aes(group = other_condition),
               position = position_dodge(width = 0.4), size = 0.8) +
  facet_wrap(~question_label, nrow = 1) +
  scale_color_manual(values = c("increase" = "red", "decrease" = "blue")) +
  labs(
    title = "SRM Perceiver Effect by Question",
    x = "Participant Condition",
    y = "Perceiver Effect (measure.p)",
    color = "Other Condition"
  ) +
  theme_minimal(base_size = 12)

# å±•ç¤ºå›¾
print(g)

```

